# Task 1.6 Testing Instructions
## Create Walrus Client Wrapper

### Prerequisites
- Task 1.1 completed (Supabase dependencies installed)
- Task 1.2 completed (Environment variables configured)
- Task 1.3 completed (Database schema created)
- Task 1.4 completed (Supabase client utilities implemented)
- Task 1.5 completed (Walrus SDK installed)

---

## Step 1: Verify Files Created

1. **Check Walrus client file exists**
   ```bash
   ls -la frontend/src/lib/walrus/client.ts
   ```

2. **Check Sui client file exists** (dependency for Walrus)
   ```bash
   ls -la frontend/src/lib/sui/client.ts
   ```

**Expected**: Both files should exist

---

## Step 2: Verify File Structure

1. **View the Walrus client file**
   ```bash
   cat frontend/src/lib/walrus/client.ts | head -30
   ```

2. **Verify it contains:**
   - Import statements for `@mysten/walrus`
   - `uploadToWalrus()` function
   - `uploadMultipleToWalrus()` function
   - `getBlobFromWalrus()` function
   - `getWalrusBlobUrl()` function
   - `validateFile()` function
   - `blobToDatabaseReference()` function

**Expected**: All functions should be present

---

## Step 3: Check TypeScript Compilation

1. **Run TypeScript compiler**
   ```bash
   cd frontend
   npx tsc --noEmit
   ```

2. **Expected**: No errors related to Walrus imports

---

## Step 4: Verify Exports

1. **Check exported functions**
   ```bash
   grep -n "^export" frontend/src/lib/walrus/client.ts
   ```

2. **Expected**: Should see exports for:
   - `uploadToWalrus`
   - `uploadMultipleToWalrus`
   - `getBlobFromWalrus`
   - `getWalrusBlobUrl`
   - `validateFile`
   - `blobToDatabaseReference`

---

## Step 5: Test File Validation Function

1. **Create a test script**
   ```bash
   cat > test-validation.mjs << 'EOF'
   import { validateFile } from './src/lib/walrus/client.ts';
   
   // Create a mock file
   const mockFile = new File(['test'], 'test.jpg', { type: 'image/jpeg' });
   
   // Test validation
   const result = validateFile(mockFile, {
     maxSize: 5 * 1024 * 1024, // 5MB
     allowedTypes: ['image/jpeg', 'image/png']
   });
   
   console.log('Validation result:', result);
   console.log('File is valid:', result.valid);
   EOF
   ```

2. **Note**: This test may not run directly due to Next.js environment, but validates the structure

3. **Clean up**
   ```bash
   rm -f test-validation.mjs
   ```

---

## Step 6: Verify Helper Functions

1. **Check for utility functions**
   ```bash
   grep -E "(validateFile|blobToDatabaseReference|getWalrusBlobUrl)" frontend/src/lib/walrus/client.ts | head -5
   ```

2. **Expected**: All helper functions should be present

---

## Step 7: Check Imports

1. **Verify imports are correct**
   ```bash
   head -5 frontend/src/lib/walrus/client.ts
   ```

2. **Expected**: Should import from `@mysten/walrus`

---

## Step 8: Test Build

1. **Try to build the project**
   ```bash
   cd frontend
   npm run build
   ```

2. **Expected**: Build should complete without errors related to Walrus

**Note**: Build may fail if other parts aren't implemented yet, but Walrus-specific errors should not appear.

---

## Success Criteria Checklist

- [x] `frontend/src/lib/walrus/client.ts` file exists
- [x] `frontend/src/lib/sui/client.ts` file exists
- [x] `uploadToWalrus()` function is exported
- [x] `uploadMultipleToWalrus()` function is exported
- [x] `getBlobFromWalrus()` function is exported
- [x] `getWalrusBlobUrl()` function is exported
- [x] `validateFile()` helper function exists
- [x] `blobToDatabaseReference()` helper function exists
- [x] TypeScript compilation has no errors
- [x] All functions have proper JSDoc comments

---

## Troubleshooting

### Error: "Cannot find module '@mysten/walrus'"
**Solution:**
```bash
cd frontend
npm install
```

### Error: "Cannot find module '@/lib/sui/client'"
**Solution:**
The Sui client file should be created automatically. If not:
1. Check that `frontend/src/lib/sui/client.ts` exists
2. Verify the file structure is correct

### TypeScript errors about Walrus types
**Solution:**
```bash
cd frontend
npm install @mysten/walrus --save
```

### Function not exported
**Solution:**
Make sure functions are prefixed with `export` keyword:
```typescript
export async function uploadToWalrus(...) { ... }
```

### Build fails with module resolution errors
**Solution:**
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
```

---

## Additional Notes

### About the Walrus Client Wrapper

The wrapper provides:
- **Simplified API**: Easy-to-use functions for common operations
- **Error Handling**: Comprehensive error catching and reporting
- **Validation**: File validation before upload
- **Batch Operations**: Upload multiple files
- **Database Integration**: Convert blobs to database format

### Function Descriptions

- `uploadToWalrus()`: Upload a single file to Walrus
- `uploadMultipleToWalrus()`: Upload multiple files with progress tracking
- `getBlobFromWalrus()`: Retrieve a blob by ID
- `getWalrusBlobUrl()`: Generate public URL for a blob
- `validateFile()`: Validate file before upload
- `blobToDatabaseReference()`: Convert blob to database format

### Next Steps

After creating the wrapper, you can:
1. Use these functions in API routes
2. Build upload UI components
3. Integrate with image upload forms
4. Store blob references in database

---

## Next Steps

After completing Task 1.6, proceed to **Task 1.7**: Implement API endpoint for image uploads (`src/app/api/walrus/upload/route.ts`)
