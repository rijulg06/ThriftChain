# Task 1.4 Testing Instructions
## Implement Supabase Client Utilities

### Prerequisites
- Task 1.1 completed (Supabase dependencies installed)
- Task 1.2 completed (Environment variables configured)
- Task 1.3 completed (Database schema created)

---

## Step 1: Verify Files Created

1. **Check client-side file exists**
   ```bash
   ls -la frontend/src/lib/supabase/client.ts
   ```

2. **Check server-side file exists**
   ```bash
   ls -la frontend/src/lib/supabase/server.ts
   ```

3. **Check helper queries file exists**
   ```bash
   ls -la frontend/src/lib/supabase/queries.ts
   ```

4. **Check database types file exists**
   ```bash
   ls -la frontend/src/lib/supabase/database.types.ts
   ```

**Expected**: All four files should exist

---

## Step 2: Test Client-Side Import

1. **Create a test script**
   ```bash
   cd frontend
   cat > test-client.mjs << 'EOF'
   import { supabaseClient } from './src/lib/supabase/client.ts';
   console.log('✅ Client imported successfully');
   console.log('Client type:', typeof supabaseClient);
   EOF
   ```

2. **Note**: This test may fail at runtime due to Next.js SSR requirements, but the import should work during build

3. **Clean up**
   ```bash
   rm -f test-client.mjs
   ```

---

## Step 3: Verify Environment Variables Check

The clients should validate environment variables on import.

1. **Test in a Node.js script** (temporarily in frontend directory)
   ```bash
   cd frontend
   node << 'EOF'
   // Simulate missing env vars
   const originalEnv = process.env.NEXT_PUBLIC_SUPABASE_URL;
   delete process.env.NEXT_PUBLIC_SUPABASE_URL;
   
   try {
     require('./src/lib/supabase/client.ts');
     console.log('❌ Should have thrown an error');
   } catch (e) {
     console.log('✅ Correctly detected missing environment variable');
   } finally {
     process.env.NEXT_PUBLIC_SUPABASE_URL = originalEnv;
   }
   EOF
   ```

**Expected**: Should print "✅ Correctly detected missing environment variable"

---

## Step 4: Test Client File Structure

1. **View the client file**
   ```bash
   cat frontend/src/lib/supabase/client.ts | head -25
   ```

2. **Verify it contains:**
   - Import from `@supabase/ssr`
   - Environment variable validation
   - `createBrowserClient` call
   - Export of `supabaseClient`

**Expected**: All components present

---

## Step 5: Test Server File Structure

1. **View the server file**
   ```bash
   cat frontend/src/lib/supabase/server.ts | head -40
   ```

2. **Verify it contains:**
   - Import from `@supabase/ssr`
   - Import from `next/headers` (cookies)
   - Environment variable validation
   - `getSupabaseServerClient()` function
   - `getSupabaseAdminClient()` function
   - Cookie handling logic

**Expected**: All components present

---

## Step 6: Test Queries File

1. **View the queries file**
   ```bash
   cat frontend/src/lib/supabase/queries.ts
   ```

2. **Verify it contains:**
   - Import of `supabaseClient`
   - User query functions (`getUserByWallet`, `createUser`)
   - Item query functions (`getItems`, `getItemById`)
   - Offer query functions (`getOffers`)
   - Transaction query functions (`getTransactions`)

**Expected**: All query functions present

---

## Step 7: Verify No TypeScript Errors

1. **Check TypeScript compilation**
   ```bash
   cd frontend
   npx tsc --noEmit
   ```

2. **Expected Output:**
   - No errors (or only warnings about unused variables)

---

## Step 8: Test Build

1. **Try to build the project**
   ```bash
   cd frontend
   npm run build
   ```

2. **Expected**: Build should complete without errors related to Supabase imports

**Note**: Build may fail if environment variables aren't set in build environment, but that's expected for now.

---

## Success Criteria Checklist

- [x] `frontend/src/lib/supabase/client.ts` file exists
- [x] `frontend/src/lib/supabase/server.ts` file exists
- [x] `frontend/src/lib/supabase/queries.ts` file exists
- [x] `frontend/src/lib/supabase/database.types.ts` file exists
- [x] Client file validates environment variables
- [x] Server file has both server client and admin client functions
- [x] Queries file has helper functions for common queries
- [x] TypeScript compilation has no errors
- [x] Project builds successfully (or builds without Supabase-related errors)

---

## Troubleshooting

### Error: "Cannot find module '@supabase/ssr'"
**Solution:**
```bash
cd frontend
npm install
```

### Error: "Missing Supabase environment variables"
**Solution:**
1. Check that `.env.local` exists in `frontend/` directory
2. Verify environment variables are set (Task 1.2)
3. Run: `cd frontend && node env.test.js`

### TypeScript errors about missing types
**Solution:**
The `database.types.ts` file uses placeholder types. This is expected for now. Types will be properly generated in production.

### Build fails with Supabase errors
**Solution:**
Make sure environment variables are available during build:
```bash
cd frontend
# Set env vars or use a .env.local file
NEXT_PUBLIC_SUPABASE_URL=... NEXT_PUBLIC_SUPABASE_ANON_KEY=... npm run build
```

### Cannot import from server file
**Solution:**
Server-side code can only be imported in:
- API routes (`app/api/**/route.ts`)
- Server Components (files without `"use client"`)
- Server Actions

---

## Next Steps

After completing Task 1.4, proceed to **Task 1.5**: Install and configure Walrus SDK for decentralized storage

