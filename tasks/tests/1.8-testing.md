# Task 1.8 Testing Instructions
## Test contract functions end-to-end on testnet

### Prerequisites
- Task 1.6 completed (contracts deployed to testnet)
- Task 1.7 completed (frontend config updated with package ID)
- Sui CLI configured and working
- Testnet wallet with SUI tokens

---

## Step 1: Test create_item Function

1. **Action to perform**: Call `create_item` function via Sui CLI
2. **Expected output**: Transaction succeeds, item NFT minted, ItemCreated event emitted
3. **Verification method**: Check transaction digest and created objects
4. **Success criteria**: 
   - Transaction status: Success
   - ItemCreated event emitted with correct details
   - Item stored in Marketplace items table
   - ItemCap object updated

### Command to test:
```bash
sui client call --package 0xe1b7d6993448d0c3b79e92432be9b13a8db8470bef0e3ce20402f9cef9bf018c \
  --module thriftchain --function create_item \
  --args <MARKETPLACE_ID> <ITEMCAP_ID> "Test Item" "A test item for ThriftChain" \
  1000000000 "Electronics" "[\"test\",\"item\"]" "[\"https://example.com/image1.jpg\"]" \
  "Good" "Apple" "Medium" "Blue" "Plastic" 0x6 \
  --gas-budget 100000000
```

---

## Step 2: Test create_offer Function (BLOCKED - Contract Design Issue)

1. **Action to perform**: Attempt to call `create_offer` function via Sui CLI
2. **Expected output**: Function call fails due to contract design issue
3. **Verification method**: Check error message about object ownership
4. **Success criteria**: 
   - Error message indicates objects owned by other objects cannot be used as input
   - This confirms the contract design issue

### Issue Identified:
The contract stores items in a `Table<ID, ThriftItem>` within the Marketplace object, but the `create_offer` function expects a direct reference to a `ThriftItem`. This is a fundamental design flaw.

### Error Expected:
```
Object <ITEM_ID> is owned by object <MARKETPLACE_ID>. Objects owned by other objects cannot be used as input arguments
```

---

## Step 3: Test accept_offer Function (BLOCKED - Contract Design Issue)

1. **Action to perform**: Attempt to call `accept_offer` function via Sui CLI
2. **Expected output**: Function call fails due to same contract design issue
3. **Verification method**: Check error message about object ownership
4. **Success criteria**: 
   - Error message indicates objects owned by other objects cannot be used as input
   - This confirms the contract design issue

### Issue Identified:
Same issue as create_offer - functions expect direct references to objects that are stored in Tables within the Marketplace.

---

## Step 4: Verify Object Queries

1. **Action to perform**: Query created objects using `sui client object <id>`
2. **Expected output**: Objects can be queried successfully
3. **Verification method**: Check object details and state
4. **Success criteria**: 
   - Marketplace object shows updated counters
   - ItemCap object shows correct ownership
   - Dynamic field objects can be queried

### Commands to test:
```bash
# Query Marketplace object
sui client object <MARKETPLACE_ID>

# Query ItemCap object  
sui client object <ITEMCAP_ID>

# Query dynamic field object
sui client object <DYNAMIC_FIELD_ID>
```

---

## Success Criteria Checklist

- [ ] `create_item` function executes successfully
- [ ] ItemCreated event emitted with correct details
- [ ] Item stored in Marketplace items table (size = 1)
- [ ] ItemCap object updated correctly
- [ ] Marketplace object shows item_counter = 1
- [ ] All created objects can be queried successfully
- [ ] Contract design issues identified and documented
- [ ] Error messages clearly indicate the problems

---

## Contract Design Issues Identified

### Issue 1: Object Reference Problem
**Problem**: Functions like `create_offer` and `accept_offer` expect direct references to `ThriftItem` and `Offer` objects, but these are stored in Tables within the Marketplace object.

**Impact**: These functions cannot be called because the objects are not directly accessible.

**Solution Required**: 
1. Store items and offers as separate objects that can be directly referenced, OR
2. Modify functions to work with IDs and look up objects within the Marketplace

### Issue 2: Function Signature Mismatch
**Problem**: The contract design doesn't match the function signatures.

**Impact**: Core marketplace functionality (offers, escrow) cannot be used.

**Solution Required**: Redesign the contract architecture to match the intended functionality.

---

## Troubleshooting

### Common Error: "Object owned by other objects cannot be used as input"
**Solution:** This is a contract design issue that requires code changes to the Move contract.

### Common Error: "Object does not exist"
**Solution:** Verify the object ID is correct and the object exists.

### Common Error: "Transaction validator signing failed"
**Solution:** Check that all required objects are owned by the caller and accessible.

---

## Next Steps

After completing Task 1.8, the following actions are required:

1. **CRITICAL**: Fix the contract design issues before proceeding to Phase 2
2. **Options**:
   - Redesign the contract to store items/offers as separate objects
   - Modify functions to work with IDs instead of direct references
   - Consider using a different architecture pattern

3. **Recommendation**: Redesign the contract before continuing with frontend development

---

## Test Results Summary

✅ **Working Functions:**
- `create_item` - Successfully creates items and stores them in Marketplace

❌ **Blocked Functions:**
- `create_offer` - Contract design issue
- `accept_offer` - Contract design issue  
- `counter_offer` - Contract design issue
- `confirm_delivery` - Contract design issue

✅ **Working Features:**
- Object querying works correctly
- Events are emitted properly
- State updates are tracked correctly

**Overall Assessment**: The contract has fundamental design issues that prevent the core marketplace functionality from working. A redesign is required before proceeding with frontend development.
