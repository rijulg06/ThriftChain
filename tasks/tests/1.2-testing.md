# Task 1.2 Testing Instructions
## Write `thriftchain.move` - ThriftItem struct & create_item function

### Prerequisites
- Task 1.1 completed (Move contract directory structure)
- Sui CLI installed and working
- Move.toml configured correctly

---

## Step 1: Verify Contract File Exists

1. **Action:** Check that the thriftchain.move file exists
2. **Command:** `ls -la contracts/marketplace/sources/thriftchain.move`
3. **Expected output:** File exists with non-zero size
4. **Verification:** File is present and accessible

---

## Step 2: Verify Contract Compilation

1. **Action:** Build the Move contract
2. **Command:** `cd contracts/marketplace && sui move build`
3. **Expected output:** 
   ```
   BUILDING ThriftChain
   [warnings about entry functions and unused variables]
   ```
4. **Verification:** Build succeeds with exit code 0 (warnings are acceptable)

---

## Step 3: Verify ThriftItem Struct Definition

1. **Action:** Check that ThriftItem struct is properly defined
2. **Command:** `grep -A 20 "struct ThriftItem" contracts/marketplace/sources/thriftchain.move`
3. **Expected output:** Struct with fields: id, title, description, price, category, tags, walrus_image_ids, seller, created_at, status, condition, brand, size, color, material
4. **Verification:** All required fields are present with correct types

---

## Step 4: Verify create_item Function

1. **Action:** Check that create_item function is implemented
2. **Command:** `grep -A 10 "fun create_item" contracts/marketplace/sources/thriftchain.move`
3. **Expected output:** Function signature with proper parameters
4. **Verification:** Function exists with correct parameters

---

## Step 5: Verify Events Definition

1. **Action:** Check that ItemCreated event is defined
2. **Command:** `grep -A 8 "struct ItemCreated" contracts/marketplace/sources/thriftchain.move`
3. **Expected output:** Event struct with fields: item_id, seller, title, price, category, created_at
4. **Verification:** Event struct is properly defined with copy and drop abilities

---

## Step 6: Verify Item Management Functions

1. **Action:** Check that item management functions exist
2. **Command:** `grep "fun update_item_price\|fun cancel_item\|fun mark_as_sold" contracts/marketplace/sources/thriftchain.move`
3. **Expected output:** All three functions are present
4. **Verification:** Functions are defined for item lifecycle management

---

## Step 7: Verify View Functions

1. **Action:** Check that view functions exist
2. **Command:** `grep "fun get_item_details\|fun get_item_images\|fun get_item_metadata" contracts/marketplace/sources/thriftchain.move`
3. **Expected output:** All view functions are present
4. **Verification:** Functions exist for querying item data

---

## Move Contract Testing (Sui-Specific)

### Unit Tests in Move
- [ ] **Test module structure**: Create `thriftchain_tests.move` file in `tests/` directory
- [ ] **Test annotations**: Use `#[test]` and `#[test, expected_failure]` properly
- [ ] **Test scenario usage**: Use `test_scenario::begin()` for complex object interactions
- [ ] **Dummy context**: Use `tx_context::dummy()` for simple function tests
- [ ] **Event testing**: Verify events are emitted using `event::events_by_type<T>()`
- [ ] **Clock testing**: Use `clock::create_for_testing()` for time-dependent functions
- [ ] **Assertions**: Use `assert_eq!` instead of `assert!` with equality checks
- [ ] **Cleanup**: Use `destroy_for_testing()` for proper test cleanup

### Move Test Commands
- [ ] **Run tests**: `sui move test` executes all unit tests
- [ ] **Test specific module**: `sui move test --filter thriftchain_tests`
- [ ] **Test with gas**: `sui move test --gas-budget 10000000`
- [ ] **Test coverage**: `sui move test --coverage` (if available)

### Integration Testing
- [ ] **Local network testing**: Use `sui start` for local development
- [ ] **Testnet deployment**: Deploy to testnet for integration testing
- [ ] **Transaction testing**: Test full transaction flows with real objects
- [ ] **Event subscription**: Test real-time event handling
- [ ] **Gas estimation**: Verify gas costs are reasonable

---

## Success Criteria Checklist

- [ ] Contract file exists at `contracts/marketplace/sources/thriftchain.move`
- [ ] Contract compiles without errors (`sui move build` succeeds)
- [ ] ThriftItem struct defined with all required fields
- [ ] create_item function implemented with proper parameters
- [ ] ItemCreated event defined with correct fields
- [ ] Item management functions present (update_item_price, cancel_item, mark_as_sold)
- [ ] View functions present (get_item_details, get_item_images, get_item_metadata)
- [ ] All structs have proper abilities (key, store, copy, drop)
- [ ] Functions emit events using `event::emit()`
- [ ] **Move unit tests pass**: `sui move test` returns success
- [ ] **Integration tests pass**: Full transaction flow works on testnet
- [ ] **Events verified**: All expected events are emitted correctly
- [ ] **Gas costs reasonable**: Transaction gas costs are within acceptable limits

---

## Troubleshooting

### Common Error: "Failed to build Move modules"
**Solution:** Check imports and ensure all required modules are imported correctly. Verify Move.toml configuration.

### Common Error: "Unbound type 'String'"
**Solution:** Ensure `use std::string::{Self, String};` is imported at the top of the file.

### Common Error: "Unbound type 'vector'"
**Solution:** Use `vector<String>` instead of `Vec<String>` in Move contracts.

### Common Error: "Struct visibility modifiers are not supported"
**Solution:** Remove `public` keyword from struct declarations in legacy Move edition.

### Sui-Specific Errors

#### "TestScenario not properly cleaned up"
**Solution:** Ensure `test_scenario::end()` is called in all test functions

#### "Clock testing functions not available"
**Solution:** Use `clock::create_for_testing()` and related testing functions

#### "Event not found in test"
**Solution:** Use `event::events_by_type<T>()` to query emitted events

#### "Gas budget exceeded"
**Solution:** Increase gas budget or optimize contract functions

#### "Test module not found"
**Solution:** Create `tests/thriftchain_tests.move` file with proper test structure

---

## Next Steps

After completing Task 1.2, proceed to **Task 1.3**: Write Offer system in Move contract with counter-offer negotiation

The ThriftItem struct and create_item function are now ready for the offer system implementation.
